<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="http://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="Genpact" type="image/png" href="/static/logo.png" />
    <title>Malware Detection!</title>      
    </head>
  <body>
<div class="row d-flex justify-content-center">

  <!--Grid column-->
  <div class="col-md-6">
	<h1><img src="/static/logo.png" id="logo" />Malware Detection!</h1>


    <form action="/handleUpload" method="post" enctype="multipart/form-data">
      <div class="custom-file">
          <input type="file" class="custom-file-input" name="file" id="file">
          <label class="custom-file-label" for="file">Choose a file</label>
       </div></br>
        <button type="submit" class="btn btn-primary">Submit</button></br>
      </form> 
		{% with messages = get_flashed_messages() %}
		  {% if messages %}    
			{% for message in messages %}
			  <div class="alert alert-danger" role="alert">{{ message }}</div>
			{% endfor %}
		  {% endif %}
		{% endwith %}

		{% if success_message %}    
			<div class="alert alert-success" role="alert">file submitted::{{ success_message }}</div>
		{% endif %}
    </div>
	<!--div id="imgSrc"><img src="/static/test.png"></img></div>	

	<div id="result" ></div-->
  </div>
  <div  class="row d-flex justify-content-center">
	<div class="col-md-6">
		<div class="alert alert-success" role="alert"><img id="imgSrc" style="width:20%; height=20%;"/></div>
		<button class="btn btn-primary" onclick="javascript:predict()">Predict</button>
		<button class="btn btn-primary" onclick="javascript:refresh()">Refresh Image</button></br>
		<div class="alert alert-success" role="alert" id="result"></div>
	</div>
  </div>
      <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--script src="http://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script-->
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="http://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<script>
	
	//var url = "/static/test.png?rnd="+Math.random();
	//$("#imgSrc").attr("src", "/static/test.png");
	
	
	$(document).ready(function() {
	 var url = "/static/test.png?rnd="+Math.random();
	 $("#imgSrc").attr("src", url);
	 });
		 
	function refresh(){
		 var url = "/static/test.png?rnd="+Math.random();
		 //alert('refresh')
		 //var img = document.createElement("img");
		 //img.src = "/static/test.png";
		 //var src = document.getElementById("imgSrc");
		 //src.appendChild(img);
		 $("#imgSrc").attr("src", url);
		 
	}
	
	// Add the following code if you want the name of the file appear on select
	$(".custom-file-input").on("change", function() {
	  var fileName = $(this).val().split("\\").pop();
	  $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
	});
	
	function predict()
	{
		//alert('clicked predict')
		$.ajax({
		  type: "POST",
		  crossDomain: true,
		  url: "http://localhost:5000/predict",
		  data: " "
		}).done(function(o) {
		  $("#result").text("Predicted: " + o);
		}).fail(function(jqXHR, textStatus) {
			$("#result").text( "error: " + jqXHR.statusText );
		});
	}
			
	</script>
  </body>
</html>